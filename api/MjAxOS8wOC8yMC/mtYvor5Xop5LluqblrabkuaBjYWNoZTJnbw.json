{"title":"测试角度学习 cache2go","date":"2019-08-20T13:44:35.633Z","date_formatted":{"ll":"Aug 20, 2019","L":"08/20/2019","MM-DD":"08-20"},"link":"2019/08/20/测试角度学习cache2go","comments":true,"tags":["Go","测试实践"],"categories":["test"],"updated":"2020-08-08T09:53:06.743Z","content":"<h2><span id=\"cache2go-介绍\">cache2go 介绍</span><a href=\"2019/08/20/测试角度学习cache2go#undefined\"></a></h2><p>“Concurrency-safe golang caching library with expiration capabilities.”。作者如是介绍该项目，翻译后的意思为：存在心跳机制且并发安全的go语言缓存库。</p>\n<h3><span id=\"tips\">tips</span><a href=\"2019/08/20/测试角度学习cache2go#undefined\"></a></h3><p>测试行为，而非实施。 “The public API of a package declare this is what(行为) I do, not this is <del>how(实施)</del> I do it.”</p>\n<a id=\"more\"></a>\n<h3><span id=\"测试角度学习-cache2go\">测试角度学习 cache2go</span><a href=\"2019/08/20/测试角度学习cache2go#undefined\"></a></h3><p>我们知道心跳机制、并发安全是 cache2go 的两大特点，那么肯定是测试的重点了。 【Cachetable 简称 table，cacheitem 简称 item】</p>\n<p>首先查看 cache_test.go ，可以获得以下信息：</p>\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th>测试点</th>\n<th>描述</th>\n<th>具体因子</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>TestCache</td>\n<td>创建 table ，添加 item ，获取 item 基本信息</td>\n<td>Cache, table.Add, table.Value, item.AccessCount, item.LifeSpan, item.AccessedOn、item.CreateOn</td>\n</tr>\n<tr>\n<td>TestCacheExpire</td>\n<td><strong>心跳机制</strong>：超出 lifeSpan 存活时间后自动消除 item</td>\n<td>Cache, table.Add, table.Value</td>\n</tr>\n<tr>\n<td>TestExists</td>\n<td>table 表中是否存在 item</td>\n<td>Cache, table.Add, <strong>table.Exists</strong></td>\n</tr>\n<tr>\n<td>TestNotFoundAdd</td>\n<td>table 表中是否存在 item ，若不存在则添加</td>\n<td>Cache, table.Add, <strong>table.NotFoundAdd</strong></td>\n</tr>\n<tr>\n<td>TestNotFoundAddConcurrency</td>\n<td><strong>并发安全</strong>： NotFoundAdd</td>\n<td>Cache, <strong>table.NotFoundAdd</strong>, <strong>table.Foreach</strong></td>\n</tr>\n<tr>\n<td>TestCacheKeepAlive</td>\n<td><strong>心跳机制</strong>： item 重新计时</td>\n<td>Cache, table.Add, <strong>item.KeepAlive</strong>, table.Exists</td>\n</tr>\n<tr>\n<td>TestDelete</td>\n<td>从 table 表中删除 item</td>\n<td>Cache, table.Add, table.Value, <strong>table.Delete</strong></td>\n</tr>\n<tr>\n<td>TestFlush</td>\n<td>清空 table 表所有 item</td>\n<td>Cache, table.Add, <strong>table.Flush</strong>, table.Value</td>\n</tr>\n<tr>\n<td>TestCount</td>\n<td>table 表中 item 数量</td>\n<td>Cache, table.Add, table.Value, <strong>table.Count</strong></td>\n</tr>\n<tr>\n<td>TestDataLoader</td>\n<td>访问不存在的 item 时会触发 loadData 回调函数</td>\n<td>Cache, <strong>table.SetDataLoader</strong>, NewCacheItem, table.Value, table.Exists, item.Data</td>\n</tr>\n<tr>\n<td>TestAccessCount</td>\n<td>返回访问频率高的 count 条 item</td>\n<td>Cache, table.Add, table.Value, <strong>table.MostAccessed</strong></td>\n</tr>\n<tr>\n<td>TestCallbacks</td>\n<td>增加、删除或超时移除情况下触发回调</td>\n<td>Cache, <strong>table.SetAddItemCallback</strong>, <strong>table.SetAboutToDeleteItemCallback</strong>, <strong>item.SetAboutToExpireCallback</strong>, table.Add</td>\n</tr>\n<tr>\n<td>TestCallbackQueue</td>\n<td>设置、增加、清除 item 的回调函数正常</td>\n<td>Cache, item.Key, table.Add, <strong>table.AddAddedItemCallback</strong>, <strong>table.AddAboutToDeleteItemCallback</strong>, <strong>item.AddAboutToExpireCallback</strong>, <strong>table.RemoveAddedItemCallbacks</strong>, <strong>table.RemoveAboutToDeleteItemCallback</strong>, <strong>item.SetAboutToExpireCallback</strong>, <strong>item.RemoveAboutToExpireCallback</strong></td>\n</tr>\n<tr>\n<td>TestLogger</td>\n<td>设置 logger 正常</td>\n<td>Cache, <strong>table.SetLogger</strong>, table.Add</td>\n</tr>\n</tbody>\n</table></div></div>\n<p>再查看benchmark_test.go，可得：</p>\n<div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th>基准测试</th>\n<th>具体因子</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>BenchmarkNotFoundAdd</td>\n<td>基准测试： NotFoundAdd</td>\n<td>Cache, <strong>table.NotFoundAdd</strong></td>\n</tr>\n</tbody>\n</table></div></div>\n","prev":{"title":"测试角度学习 groupcache","link":"2019/08/21/测试角度学习groupcache"},"next":{"title":"Go Testing;How,What,Why","link":"2019/07/28/Go_Testing"},"plink":"http://yoursite.com/2019/08/20/测试角度学习cache2go/","toc":[{"title":"cache2go 介绍</span>","id":"cache2go-介绍","index":"1","children":[{"title":"tips</span>","id":"tips","index":"1.1"},{"title":"测试角度学习 cache2go</span>","id":"测试角度学习-cache2go","index":"1.2"}]}],"copyright":{"license":"unknown","published":"August 20, 2019","updated":"August 8, 2020","author":"wangwg"}}