<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>I'm here.</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link href="/css/bootstrap.min.css" rel="stylesheet"><link href="/css/font-awesome.min.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"></head><body><div class="wrap"><nav class="page-navigation"><div class="nav-container"><div class="page-header-logo"><h1 class="prince-log"><a href="/" class="home-link">zlin</a></h1></div><button type="button" data-toggle="collapse" data-target=".main-nav-items" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><ul class="collapse navbar-collapse main-nav-items"><li class="menu-item"><a href="/" target="_self">HOME</a></li><li class="menu-item"><a href="/archives/" target="_self">ARCHIVE</a></li><li class="menu-item"><a href="/gallery/" target="_self">GALLERY</a></li><li class="menu-item"><a href="/about/" target="_self">ABOUT</a></li></ul></div></nav><main class="prince-container"><div class="post"><article class="post-block"><h1 class="post-title">Ginkgo 测试框架使用入门</h1><div class="post-info">Aug 28th 2019</div><div class="post-entry"><h1><span id="ginkgo-介绍">Ginkgo 介绍</span></h1><p>Ginkgo是一个BDD风格的Go测试框架，旨在帮助您有效地编写富有表现力的综合测试。</p>
<h2><span id="安装及依赖">安装及依赖</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/onsi/ginkgo/ginkgo</span><br><span class="line">$ go get github.com/onsi/gomega/...</span><br></pre></td></tr></table></figure>
<p>在 $GOPATH 下使用上述命令安装 ginkgo 及匹配器 gomega。使用过程中遇到的问题：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ginkgo <span class="comment">#or go test</span></span><br><span class="line">Failed to compile 0344-reverse-string:</span><br><span class="line"></span><br><span class="line"><span class="comment"># leetcode/case/0344-reverse-string</span></span><br><span class="line">package leetcode/<span class="keyword">case</span>/0344-reverse-string_test</span><br><span class="line">        imports github.com/onsi/gomega</span><br><span class="line">        imports github.com/onsi/gomega/matchers</span><br><span class="line">        imports golang.org/x/net/html/charset</span><br><span class="line">        imports golang.org/x/text/encoding: cannot find package <span class="string">"golang.org/x/text/encoding"</span> <span class="keyword">in</span> any of:</span><br><span class="line">        /usr/<span class="built_in">local</span>/go/src/golang.org/x/text/encoding (from <span class="variable">$GOROOT</span>)</span><br><span class="line">        /Users/night/go_learn/src/golang.org/x/text/encoding (from <span class="variable">$GOPATH</span>)</span><br></pre></td></tr></table></figure></p>
<p>问题为 text/encoding 包未找到，解决方案如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src</span><br><span class="line">$ mkdir golang.org/x/</span><br><span class="line">$ <span class="built_in">cd</span> golang.org/x</span><br><span class="line">$  git <span class="built_in">clone</span> https://github.com/golang/text.git text</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2><span id="初步使用">初步使用</span></h2><p>1、执行 <strong>ginkgo bootstrap</strong> ，生成 package_suite_test.go 模版文件，包含入口函数，例子如下。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ginkgo bootstrap                                 </span><br><span class="line">Generating ginkgo <span class="built_in">test</span> suite bootstrap <span class="keyword">for</span> problem0344 <span class="keyword">in</span>:</span><br><span class="line">        0344_reverse_string_suite_test.go</span><br><span class="line">$</span><br><span class="line">$ cat 0344_reverse_string_suite_test.go</span><br><span class="line">package problem0344_test</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">        <span class="string">"testing"</span></span><br><span class="line"></span><br><span class="line">        . <span class="string">"github.com/onsi/ginkgo"</span></span><br><span class="line">        . <span class="string">"github.com/onsi/gomega"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func Test0344ReverseString(t *testing.T) &#123;</span><br><span class="line">        RegisterFailHandler(Fail)</span><br><span class="line">        RunSpecs(t, <span class="string">"0344ReverseString Suite"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2、执行 <strong>ginkgo generate xx</strong>（ xx 可不写，默认为当前文件夹名）是， 生成 xx_test.go ，例子如下。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ginkgo generate                         </span><br><span class="line">Generating ginkgo <span class="built_in">test</span> <span class="keyword">for</span> 0344ReverseString <span class="keyword">in</span>:</span><br><span class="line">  0344_reverse_string_test.go</span><br><span class="line">$</span><br><span class="line">$ cat 0344_reverse_string_test.go</span><br><span class="line">package problem0344_test</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">        . <span class="string">"github.com/onsi/ginkgo"</span></span><br><span class="line">        . <span class="string">"github.com/onsi/gomega"</span></span><br><span class="line"></span><br><span class="line">        . <span class="string">"leetcode/case/0344-reverse-string"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var _ = Describe(<span class="string">"0344ReverseString"</span>, <span class="function"><span class="title">func</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>常规做法： package_suite_test.go 作为入口， xx_test.go 作为各个文件的测试源文件。</p>
<h2><span id="功能点">功能点</span></h2><p>常用的模块及介绍如下表。</p>
<table>
<thead>
<tr>
<th style="text-align:left">模块</th>
<th style="text-align:left">功能描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">It</td>
<td style="text-align:left">It 包含的代码为一个测试用例</td>
</tr>
<tr>
<td style="text-align:left">Specify</td>
<td style="text-align:left">和 It 功能一致， 可作为别名在适当位置替换 It</td>
</tr>
<tr>
<td style="text-align:left">Describe</td>
<td style="text-align:left">将一个或多个测试用例归类</td>
</tr>
<tr>
<td style="text-align:left">Context</td>
<td style="text-align:left">同 Describe</td>
</tr>
<tr>
<td style="text-align:left">BeforeEach</td>
<td style="text-align:left">每个测试用例执行前执行该段代码</td>
</tr>
<tr>
<td style="text-align:left">AftreEach</td>
<td style="text-align:left">每个测试用例执行后执行该段代码</td>
</tr>
<tr>
<td style="text-align:left">JustBeforeEach</td>
<td style="text-align:left">在 BeforeEach 之后，执行测试用例之前执行</td>
</tr>
<tr>
<td style="text-align:left">JustAfterEach</td>
<td style="text-align:left">在执行测试用例之后，AftreEach之前执行</td>
</tr>
<tr>
<td style="text-align:left">BeforeSuite</td>
<td style="text-align:left">在该测试集执行前执行， package_suite_test.go 中 RunSpecs 执行之前</td>
</tr>
<tr>
<td style="text-align:left">AfterSuite</td>
<td style="text-align:left">无论是否有任何测试失败，该函数都会在测试集执行后运行</td>
</tr>
<tr>
<td style="text-align:left">By</td>
<td style="text-align:left">打印信息（字符串），只会在测试例失败后打印，一般用于调试和定位问题</td>
</tr>
<tr>
<td style="text-align:left">Fail</td>
<td style="text-align:left">标志该测试例运行结果为失败，并打印里面的信息</td>
</tr>
</tbody>
</table>
<p>通过实验得到以下顺序：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ ginkgo <span class="comment">#or go test</span></span><br><span class="line">Running Suite: 0344ReverseString Suite</span><br><span class="line">======================================</span><br><span class="line">Random Seed: 1567008418</span><br><span class="line">Will run 1 of 1 specs</span><br><span class="line"></span><br><span class="line">BeforeSuite &gt; </span><br><span class="line">BeforeEach &gt; input =  zx</span><br><span class="line">JustBeforeEach &gt; append <span class="string">'l'</span> to input =  zxl</span><br><span class="line">Describe &gt; It &gt; After ReverseString input =  lxz</span><br><span class="line">JustAfterEach &gt; change input to =  I</span><br><span class="line">AfterEach &gt; input =  I</span><br><span class="line">•AfterSuite &gt; </span><br><span class="line"></span><br><span class="line">Ran 1 of 1 Specs <span class="keyword">in</span> 0.000 seconds</span><br><span class="line">SUCCESS! -- 1 Passed | 0 Failed | 0 Pending | 0 Skipped</span><br><span class="line">PASS</span><br><span class="line"></span><br><span class="line">Ginkgo ran 1 suite <span class="keyword">in</span> 2.023695404s</span><br><span class="line">Test Suite Passed</span><br></pre></td></tr></table></figure></p>
<h2><span id="f-p-x-规范">F、P、X 规范</span></h2><p>将容器（测试用例） Describe ， Context ， It ，和 Measure 标记为待定，通过添加 P 或者 X 即可。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PDescribe(<span class="string">"some behavior"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)</span><br><span class="line">PContext(<span class="string">"some scenario"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)</span><br><span class="line">PIt(<span class="string">"some assertion"</span>)</span><br><span class="line">PMeasure(<span class="string">"some measurement"</span>)</span><br><span class="line"></span><br><span class="line">XDescribe(<span class="string">"some behavior"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)</span><br><span class="line">XContext(<span class="string">"some scenario"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)</span><br><span class="line">XIt(<span class="string">"some assertion"</span>)</span><br><span class="line">XMeasure(<span class="string">"some measurement"</span>)</span><br></pre></td></tr></table></figure></p>
<p>跳过容器（测试用例），使用 skip 。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">It(<span class="string">"should do something, if it can"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !someCondition &#123;</span><br><span class="line">        Skip(<span class="string">"special condition wasn't met"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assertions go here</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>F 含义 Focus ，使用后表专注于当前容器（测试用例）。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FDescribe(<span class="string">"some behavior"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)</span><br><span class="line">FContext(<span class="string">"some scenario"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)</span><br><span class="line">FIt(<span class="string">"some assertion"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Notice</span></span><br><span class="line">FDescribe(<span class="string">"outer describe"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    It(<span class="string">"A"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)   <span class="comment">// Not do</span></span><br><span class="line">    FIt(<span class="string">"B"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; ... &#125;)  <span class="comment">// Do</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2><span id="并行测试">并行测试</span></h2><p>Ginkgo 支持并行运行规范。通过生成单独的 go test 进程并为共享队列中的每个进程提供规范来实现此目的。这对于 BDD 测试框架很重要，因为闭包的共享上下文不能在进程中很好地并行化。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ginkgo -p  <span class="comment">// 自动检测要生成的最佳测试节点数</span></span><br><span class="line">ginkgo -nodes=N  <span class="comment">// 使用 -nodes 指定要生成的节点数</span></span><br><span class="line">ginkgo -nodes=N -stream <span class="comment">// 设置 -stream 实时查看各个并行测试套件的输出</span></span><br></pre></td></tr></table></figure></p>
<h2><span id="表驱动测试">表驱动测试</span></h2><p>包 github.com/onsi/ginkgo/extensions/table 提供表扩展功能，即根据每个 Entry 生成对应的 It（容器、测试用例）。使用方式如下：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> table_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    . <span class="string">"github.com/onsi/ginkgo/extensions/table"</span></span><br><span class="line"></span><br><span class="line">    . <span class="string">"github.com/onsi/ginkgo"</span></span><br><span class="line">    . <span class="string">"github.com/onsi/gomega"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ = Describe(<span class="string">"Math"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    DescribeTable(<span class="string">"the &gt; inequality"</span>,</span><br><span class="line">        <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>, y <span class="keyword">int</span>, expected <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">            Expect(x &gt; y).To(Equal(expected))</span><br><span class="line">        &#125;,</span><br><span class="line">        Entry(<span class="string">"x &gt; y"</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">true</span>),</span><br><span class="line">        Entry(<span class="string">"x == y"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>),</span><br><span class="line">        Entry(<span class="string">"x &lt; y"</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="literal">false</span>),</span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>其等同于的展开格式如下：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> table_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    . <span class="string">"github.com/onsi/ginkgo"</span></span><br><span class="line">    . <span class="string">"github.com/onsi/gomega"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _ = Describe(<span class="string">"Math"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Describe(<span class="string">"the &gt; inequality"</span>,</span><br><span class="line">        It(<span class="string">"x &gt; y"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Expect(<span class="number">1</span> &gt; <span class="number">0</span>).To(Equal(<span class="literal">true</span>))</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        It(<span class="string">"x == y"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Expect(<span class="number">0</span> &gt; <span class="number">0</span>).To(Equal(<span class="literal">false</span>))</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        It(<span class="string">"x &lt; y"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Expect(<span class="number">0</span> &gt; <span class="number">1</span>).To(Equal(<span class="literal">false</span>))</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2><span id="异步测试">异步测试</span></h2><p>Go很好地兼容并发。Ginkgo为有效测试异步性提供支持。通过下面的例子进一步了解：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">It(<span class="string">"should post to the channel, eventually"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> DoSomething(c)</span><br><span class="line">    Expect(&lt;-c).To(ContainSubstring(<span class="string">"Done!"</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>此测试将阻塞，直到通道收到响应 c 。死锁或超时是这种测试的常见故障模式，在这种情况下，常见的模式是在函数的底部添加一个 select 语句，并包含一个 &lt;-time.After(X) 指定超时的通道。</p>
<p>Ginkgo 内置了这种模式。 body 所有非容器块（It s，BeforeEach es，AfterEach es，JustBeforeEach es，JustAfterEach es 和 Benchmark s）中的 done Done 函数都可以采用可选参数：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">It(<span class="string">"should post to the channel, eventually"</span>, <span class="function"><span class="keyword">func</span><span class="params">(done Done)</span></span> &#123;</span><br><span class="line">    c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> DoSomething(c)</span><br><span class="line">    Expect(&lt;-c).To(ContainSubstring(<span class="string">"Done!"</span>))</span><br><span class="line">    <span class="built_in">close</span>(done)</span><br><span class="line">&#125;, <span class="number">0.2</span>)</span><br></pre></td></tr></table></figure></p>
<p>Done 是一个 chan interface{} 。当 Ginkgo 检测到 done Done 参数已被请求时，它将该 body 函数作为 goroutine 运行，并使用必要的逻辑将其包装以应用超时断言。您必须关闭done 通道，或向其发送一些内容（任何内容）以告知 Ginkgo 测试已结束。如果测试在超时期限后没有结束，那么 Ginkgo 将无法通过测试并继续进行下一次测试。</p>
<p>默认超时为 1 秒。您可以通过 float64 在 body 函数后面传递（以秒为单位）来修改此超时。在该示例中，我们将超时设置为 0.2 秒。</p>
<h2><span id="基准测试">基准测试</span></h2><p>Ginkgo 使用 Measure 块来衡量代码的性能。 Measure 作用于单个测试用例（It 的位置）。传递给的闭包函数 Measure 必须带 Benchmarker 参数。将 Benchmarker 用于测量的运行时间和记录任意的数值。还必须Measure在闭包函数后传递一个整数，这表示您的代码 Measure 将执行的次数。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Measure(<span class="string">"it should do something hard efficiently"</span>, <span class="function"><span class="keyword">func</span><span class="params">(b Benchmarker)</span></span> &#123;</span><br><span class="line">    runtime := b.Time(<span class="string">"runtime"</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        output := SomethingHard()</span><br><span class="line">        Expect(output).To(Equal(<span class="number">17</span>))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    Ω(runtime.Seconds()).Should(BeNumerically(<span class="string">"&lt;"</span>, <span class="number">0.2</span>), <span class="string">"SomethingHard() shouldn't take too long."</span>)</span><br><span class="line"></span><br><span class="line">    b.RecordValue(<span class="string">"disk usage (in MB)"</span>, HowMuchDiskSpaceDidYouUse())</span><br><span class="line">&#125;, <span class="number">10</span>)</span><br></pre></td></tr></table></figure></p>
<p>将运行闭包功能 10 次，聚合”运行时”和”磁盘使用”的数据。然后， ginkgo 打印执行的性能数据：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">• [MEASUREMENT]</span><br><span class="line">Suite</span><br><span class="line">    it should <span class="keyword">do</span> something hard efficiently</span><br><span class="line"></span><br><span class="line">    Ran 10 samples:</span><br><span class="line">    runtime:</span><br><span class="line">      Fastest Time: 0.01s</span><br><span class="line">      Slowest Time: 0.08s</span><br><span class="line">      Average Time: 0.05s ± 0.02s</span><br><span class="line"></span><br><span class="line">    disk usage (<span class="keyword">in</span> MB):</span><br><span class="line">      Smallest: 3.0</span><br><span class="line">       Largest: 5.2</span><br><span class="line">       Average: 3.9 ± 0.4</span><br></pre></td></tr></table></figure></p>
<p>Measures 可以在测试中与 It s 一起执行。如果你想只运行It s，你可以将 –skipMeasurements 标志传递给 ginkgo 。</p>
</div><div class="post-tags-box"><a class="tag-link" href="/tags/Go/">Go</a>, <a class="tag-link" href="/tags/Test/">Test</a>, <a class="tag-link" href="/tags/测试实践/">测试实践</a>, <a class="tag-link" href="/tags/测试框架/">测试框架</a></div></article></div><div class="post-nav"><div class="prev-wrap col-md-6 col-xs-6"><i class="fa fa-angle-double-left"></i><a href="/2019/09/05/wangwg/" class="prev-post">wangwg</a></div><div class="next-wrap col-md-6 col-xs-6"><a href="/2019/08/21/测试角度学习groupcache/" class="next-post">测试角度学习 groupcache</a><i class="fa fa-angle-double-right"></i></div></div></main></div><footer><div class="copyright"><p>Crafted with <i class="fa fa-heart"></i> by&nbsp;zlin&nbsp;|&nbsp;<a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yiliashaw/hexo-theme-prince" target="_blank">Prince</a> by SHAW</p></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.0.47/jquery.fancybox.min.js"></script><script src="/js/script.js"></script></body></html>